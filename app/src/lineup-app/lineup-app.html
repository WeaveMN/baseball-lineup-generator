<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/iron-list/iron-list.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/iron-demo-helpers/demo-pages-shared-styles.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/app-route/app-location.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">


<dom-module id="lineup-app">
  <template>
    <style is="custom-style" include="demo-pages-shared-styles">
      :host {
        display: block;
      }
			h3 {
				font-family: 'Roboto', Helvetica, sans-serif;
			}
			app-toolbar {
        /* Toolbar is the main header, so give it some color */
        background-color: #1E88E5;
        font-family: 'Roboto', Helvetica, sans-serif;
        color: white;
        --app-toolbar-font-size: 24px;
      }
			paper-tabs {
        background-color: #1E88E5;
        color: #fff;
      }
			iron-list {
      height: 400px;
    }
			#addPlayerInput {
				width: 150px;
				display: inline-block;
			}
			#addPlayerButton {
			}
			#generateButton {
				background-color: #1E88E5;
				color:white;
				float:right;
			}
			.headLink{color:white;}
			.headLink:visited{color:white;}
			table.print{float:left;border-collapse:collapse;margin-right:10px;}
			table.print th{padding:5px;border:1px solid #000000;}
			table.print td{padding:5px;border:1px solid #000000;}
			#print {
				margin:10px;
				font-family: 'Roboto', Helvetica, sans-serif;
				font-size:10pt;
			}
    </style>
		
		<app-location route="{{route}}"></app-location>
		<app-route route="{{route}}" pattern="/:page" data="{{data}}"></app-route>
		
		<app-toolbar>
			<div>
				<a class="headLink" href="/home"><iron-icon icon="home"></iron-icon></a>
			</div>
			<div title spacer>Baseball Lineup Generator</div>
			<div>
				<a class="headLink" href="/print"><iron-icon icon="print"></iron-icon></a>
			</div>
    </app-toolbar>
		<iron-pages attr-for-selected="id" selected="{{data.page}}">
			<div id="home">
				<paper-tabs selected="{{selectedTab}}">
					<paper-tab>Setup</paper-tab>
					<paper-tab>Order</paper-tab>
					<paper-tab>1st</paper-tab>
					<paper-tab>2nd</paper-tab>
					<paper-tab>3rd</paper-tab>
					<paper-tab>4th</paper-tab>
					<paper-tab>5th</paper-tab>
				</paper-tabs>

				<iron-pages selected="{{selectedTab}}">
					<div>
						<div>
							<paper-button id="generateButton" raised on-tap="generateLineup">Generate!</paper-button>
							<h3>Set Batting Order</h3>
							<paper-input id="addPlayerInput" label="Player to Add" value="{{playerToAdd}}" on-keypress="inputSubmit"></paper-input>	
							<paper-button id="addPlayerButton" raised on-tap="addPlayer"><iron-icon icon="add"></iron-icon></paper-button>
							<div style$="{{_showActions()}}">
								Actions: 
								<!--
								<paper-button raised><iron-icon icon="arrow-upward"></iron-icon></paper-button>
								<paper-button raised><iron-icon icon="arrow-downward"></iron-icon></paper-button> -->
								<paper-button raised on-tap="removePlayer"><iron-icon icon="clear"></iron-icon></paper-button>
							</div>
						</div>
						<iron-list id="battingOrderInput" items="[[battingOrder]]" selected-item="{{selectedPlayer}}" selection-enabled>
							 <template>
								<paper-item>
									 [[_displayIndex(index)]]. [[item.name]]

								</paper-item>
							</template>
						</iron-list>
						<h3>Set Position Rotation</h3>
							<div style$="{{_showActions()}}">
								Actions: 
								<!-- <paper-button raised><iron-icon icon="arrow-upward"></iron-icon></paper-button>
								<paper-button raised><iron-icon icon="arrow-downward"></iron-icon></paper-button> -->
								<paper-button raised on-tap="removePosition"><iron-icon icon="clear"></iron-icon></paper-button>
							</div>
						<iron-list id="positionRotationInput" items="[[positionRotation]]" selected-item="{{selectedPosition}}" selection-enabled>
							 <template>
								<paper-item>
									 [[item.abbr]] - [[item.name]]
								</paper-item>
							</template>
						</iron-list>


					</div>
					<div>
						<template is="dom-repeat"items="[[battingOrder]]" >
								<paper-item>
									 [[_displayIndex(index)]]. [[item.name]]
								</paper-item>
						</template>
					</div>
					<div>
						<h3>1st Inning</h3>
						<template is="dom-repeat" items="{{innings.first}}">
								<paper-item>
									 [[item.positionName]] - [[item.player]]
								</paper-item>
						</template>
					</div>
					<div>
						<h3>2nd Inning</h3>
						<template is="dom-repeat" items="{{innings.second}}">
								<paper-item>
									 [[item.positionName]] - [[item.player]]
								</paper-item>

						</template>
					</div>
					<div>
						<h3>3rd Inning</h3>
						<template is="dom-repeat" items="{{innings.third}}">
								<paper-item>
									 [[item.positionName]] - [[item.player]]
								</paper-item>					
						</template>
					</div>
					<div>
						<h3>4th Inning</h3>
						<template is="dom-repeat" items="{{innings.fourth}}">
								<paper-item>
									 [[item.positionName]] - [[item.player]]
								</paper-item>					
						</template>			
					</div>
					<div>
						<h3>5th Inning</h3>
						<template is="dom-repeat" items="{{innings.fifth}}">
								<paper-item>
									 [[item.positionName]] - [[item.player]]
								</paper-item>					
						</template>
					</div>
				</iron-pages>				
			</div>
			<div id="print">
				<div>
					<table class="print">
						<tr><th>Batting Order</th></tr>
						<template is="dom-repeat" items="{{battingOrder}}">
							<tr>
								<td>[[_displayIndex(index)]]. [[item.name]]</td>		
							</tr>
						</template>
						</table<
					</table>
					<table class="print">
						<tr><th colspan="2">1st Inning</th></tr>
						<template is="dom-repeat" items="{{innings.first}}">
							<tr>
								<td>[[item.positionName]]</td><td>[[item.player]]</td>		
							</tr>
						</template>
					</table>
					<table class="print">
						<tr><th colspan="2">2nd Inning</th></tr>
						<template is="dom-repeat" items="{{innings.second}}">
							<tr>
								<td>[[item.positionName]]</td><td>[[item.player]]</td>		
							</tr>
						</template>
					</table>
					<table class="print">
						<tr><th colspan="2">3rd Inning</th></tr>
						<template is="dom-repeat" items="{{innings.third}}">
							<tr>
								<td>[[item.positionName]]</td><td>[[item.player]]</td>		
							</tr>
						</template>
					</table>
					<table class="print">
						<tr><th colspan="2">4th Inning</th></tr>
						<template is="dom-repeat" items="{{innings.fourth}}">
							<tr>
								<td>[[item.positionName]]</td><td>[[item.player]]</td>		
							</tr>
						</template>
					</table>
					<table class="print">
						<tr><th colspan="2">5th Inning</th></tr>
						<template is="dom-repeat" items="{{innings.fifth}}">
							<tr>
								<td>[[item.positionName]]</td><td>[[item.player]]</td>		
							</tr>
						</template>
					</table>
				</div>
			</div>
		</iron-pages>
		
		
		
		
		
    
  </template>

  <script>
    Polymer({

      is: 'lineup-app',

      properties: {
				route: {
        	type: Object
        },
				data: {
					type: Object,
					value: function() {
						return {
							page: 'home'
						};
					}
				},
        prop1: {
          type: String,
          value: 'lineup-app',
        },
				selectedTab: {
          type: Number,
          value: 0,
        },
				battingOrderInput: {
					type: String
				},
				positionRotationInput: {
					type: String
				},
				battingOrder: {
					type: Array
					
				},
				positionRotation: {
					type: Array		

				},
			
				selectedPlayer: Object,
				playerToAdd: String,
				positionToAdd: String,
				selectedPosition: Object,
				counter: Number,
				innings: Object
      },
			ready: function() {
				this.counter = 0;
				this.positionRotation = [];
				this.battingOrder = [];
				this.innings = {
					first:[],
					second:[],
					third:[],
					fourth:[],
					fifth:[]
				};
		
			},
			attached: function() {
// 				this.push('positionRotation', 
// 						{id:1,abbr:'P',name:'Pitcher'},
// 						{id:2,abbr:'C',name:'Catcher'},
// 						{id:3,abbr:'1B',name:'First Base'},
// 						{id:4,abbr:'2B',name:'Second Base'},
// 						{id:5,abbr:'3B',name:'Third Base'},
// 						{id:6,abbr:'SS',name:'Shortstop'},
// 						{id:7,abbr:'LF',name:'Left Field'},
// 						{id:8,abbr:'LC',name:'Left Center'},
// 						{id:9,abbr:'RC',name:'Right Center'},
// 						{id:10,abbr:'RF',name:'Right Field'},
// 						{id:11,abbr:'B2',name:'Bench 1'},
// 						{id:12,abbr:'B1',name:'Bench 2'}
// 				);
				
				var position_order = ['1B','RC','SS','LF','B1','3B','LC','2B','RF','B2','C','P'];
				this.push('positionRotation', 



						{id:4,abbr:'2B',name:'Second Base'},
						{id:10,abbr:'RF',name:'Right Field'},
						{id:12,abbr:'B2',name:'Bench 2'},
						{id:2,abbr:'C',name:'Catcher'},
						{id:1,abbr:'P',name:'Pitcher'},
						{id:3,abbr:'1B',name:'First Base'},
						{id:9,abbr:'RC',name:'Right Center'},
						{id:6,abbr:'SS',name:'Shortstop'},
						{id:7,abbr:'LF',name:'Left Field'},
						{id:5,abbr:'3B',name:'Third Base'},
						{id:8,abbr:'LC',name:'Left Center'}
						//{id:11,abbr:'B1',name:'Bench 1'}
				);
				this.push('battingOrder',
	
	{id:0,name:'Pax'},
	{id:1,name:'Noah'},
	{id:2,name:'Oliver'},
	{id:3,name:'Drew'},
	{id:4,name:'Grayson'},
	{id:5,name:'Josh'},
	{id:6,name:'Malachi'},
	{id:7,name:'Kayden'},
	{id:8,name:'Isaiah'},
	{id:9,name:'Cooper'},
{id:10,name:'Torsten'}									
				);
			},
			generateLineup: function(e, detail) {
				//here's the magic
				//battingOrder and positionRotation should be set by now
				//add error checking for
				//	1. Empty arrays
				//	2. arrays of different length
				var inningList = ['first','second','third','fourth','fifth'];
				var positionOrder = this._copyArray(this.positionRotation);
				for(var i=0;i<inningList.length;i++) {
					var inn = inningList[i];
					var players = [];
					for(var b = 0;b<this.battingOrder.length;b++) {
						var pos = positionOrder[b];
						var player = this.battingOrder[b];
						var val = {};
						val.player = player.name;
						val.positionName = pos.name;
						val.positionId = pos.id;
						players.push(val);
					}
					players.sort(this._dynamicSort('positionId'));
					console.log('Inning: '+inn);
					console.log('Players sorted: ', players);
					//this.innings[inn].positions.sort(dynamicSort(positionId));
					for(var p=0;p<players.length;p++) {
						this.push('innings.'+inn, players[p]);
					}
					
					var shift = positionOrder.shift();
					positionOrder.push(shift);
				}
			},
			inputSubmit: function(e,detail) {
				//console.log(e.key);
				if(e.key === 'Enter') {
					this.addPlayer();
				}
			},
			addPlayer: function(e,detail) {
				console.log(this.playerToAdd);
				console.log(this.battingOrder);
				var newPlayer = {
					id:this.counter,
					name:this.playerToAdd
				};
				this.push('battingOrder', newPlayer);
				this.counter++;
				this.playerToAdd = '';
			},
			removePlayer: function(e, detail) {
				//console.log(e);
				//console.log(detail);
				console.log(this.selectedPlayer);
				if(this.selectedPlayer !== null){
					var indexToRemove = -1;
					for(var i=0;i<this.battingOrder.length;i++) {
						var item = this.battingOrder[i];
						if(item.id === this.selectedPlayer.id) {
							indexToRemove = i;
							break;
						}
					}
					if(indexToRemove !== -1) {
						this.splice('battingOrder', indexToRemove, 1);
					}
				}
			},
			addPosition: function(e,detail) {
				console.log(this.positionToAdd);
				
			},
			removePosition: function(e, detail) {
				//console.log(e);
				//console.log(detail);
				console.log(this.selectedPosition);
				if(this.selectedPosition !== null){
					var indexToRemove = -1;
					for(var i=0;i<this.positionRotation.length;i++) {
						var item = this.positionRotation[i];
						if(item.id === this.selectedPosition.id) {
							indexToRemove = i;
							break;
						}
					}
					if(indexToRemove !== -1) {
						this.splice('positionRotation', indexToRemove, 1);
					}
				}
			},
			_showActions: function() {
				if(this.selectedPlayer !== null) {
					return 'display:inline-block;'
				}
				else {
					return 'display:none;'
				}
			},
			_displayIndex: function(index) {
				return index +1;
			},
			_copyArray: function(orgArray) {
				var newArray = JSON.parse(JSON.stringify(orgArray));
				return newArray;
			},
			_dynamicSort: function(property) {
					var sortOrder = 1;
					if(property[0] === "-") {
							sortOrder = -1;
							property = property.substr(1);
					}
					return function (a,b) {
							var result = (a[property] < b[property]) ? -1 : (a[property] > b[property]) ? 1 : 0;
							return result * sortOrder;
					}
			},
			observers: [
          '_onRoutePathChanged(route.path)'
        ],
      _onRoutePathChanged: function(path) {
          // If we do not have an initial URL, we redirect to /home
					console.log('The path: '+ path);
          if (!path || path === '/') {
            this.set('route.path', '/home');
          }
        }

    });
		
		
  </script>
</dom-module>
